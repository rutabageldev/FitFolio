schema: 1
area: auth.magic_link
updated: 2025-11-13
owners:
- backend-auth
- qa
items:
- id: AUTH-ML-001
  title: Magic link start returns 200 for known email with CSRF
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-13
- id: AUTH-ML-002
  title: Unverified user can request magic link
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-13
- id: AUTH-ML-003
  title: Magic link start respects rate limit decorator
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/security/test_rate_limiting.py
  last_verified: 2025-11-13
- id: AUTH-ML-004
  title: Magic link start invalid email format returns 422
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-13
- id: AUTH-ML-005
  title: Magic link start empty email returns 422
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-13
- id: AUTH-ML-006
  title: Magic link start database failure yields 500
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-13
- id: AUTH-ML-007
  title: Unknown email returns generic success (no enumeration)
  level: integration
  markers:
  - integration
  - security
  risk: critical
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-13
- id: AUTH-ML-101
  title: Magic link verify new user creates account and session
  level: integration
  markers:
  - security
  risk: critical
  status: deprecated
  tests: []
  last_verified: null
- id: AUTH-ML-102
  title: Magic link verify existing user logs in without duplicate
  level: integration
  markers:
  - integration
  - security
  risk: critical
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_happy_paths.py
  last_verified: 2025-11-13
- id: AUTH-ML-103
  title: Magic link verify respects rate limit decorator
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/security/test_rate_limiting.py
  last_verified: 2025-11-13
- id: AUTH-ML-104
  title: Magic link verify invalid token format returns 400
  level: integration
  markers:
  - integration
  - security
  risk: critical
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_happy_paths.py
  last_verified: 2025-11-13
- id: AUTH-ML-105
  title: Magic link verify expired token returns 400
  level: integration
  markers:
  - integration
  - security
  risk: critical
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_happy_paths.py
  last_verified: 2025-11-13
- id: AUTH-ML-106
  title: Magic link verify token not found returns 400
  level: integration
  markers:
  - integration
  - security
  risk: critical
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_error_paths.py
  last_verified: 2025-11-13
- id: AUTH-ML-107
  title: Magic link verify used token returns 400
  level: integration
  markers:
  - integration
  - security
  risk: critical
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_happy_paths.py
  last_verified: 2025-11-13
- id: AUTH-ML-108
  title: Magic link verify sets cookie with correct flags
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_happy_paths.py
  last_verified: 2025-11-13
- id: AUTH-ML-110
  title: Magic link verify rejects invalid or expired token
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_error_paths.py
  last_verified: 2025-11-13
- id: AUTH-EMAIL-201
  title: Resend verification respects rate limit decorator
  level: integration
  markers:
  - security
  risk: high
  status: deprecated
  tests: []
  last_verified: null
- id: AUTH-EMAIL-202
  title: Resend verification unauthenticated allowed returns 200
  level: integration
  markers:
  - integration
  - security
  risk: critical
  status: implemented
  tests:
  - backend/tests/auth/email/test_email_authorization.py
  last_verified: 2025-11-13
- id: AUTH-ML-201
  title: Magic link authorization checks
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_authorization.py
  last_verified: 2025-11-13
- id: AUTH-ML-202
  title: Magic link email capture
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_email_capture.py
  last_verified: 2025-11-13
- id: AUTH-ML-203
  title: Magic link integration path coverage
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_integration.py
  last_verified: 2025-11-13
- id: AUTH-ML-204
  title: Magic link verify happy paths
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_happy_paths.py
  last_verified: 2025-11-13
- id: AUTH-ML-233
  title: Verify inactive user returns 400
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_user_state_lines.py
  last_verified: 2025-11-14
- id: AUTH-ML-234
  title: Verify unverified user returns 403
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_user_state_lines.py
  last_verified: 2025-11-14
- id: AUTH-ML-220
  title: New user verification email send failure returns 500 and logs error
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-14
- id: AUTH-ML-221
  title: Existing user magic link email send failure returns 500 and logs error
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start.py
  last_verified: 2025-11-14
- id: AUTH-ML-230
  title: Verify precheck lockout returns 429 and records login_attempt_locked event
  level: integration
  markers:
  - integration
  - security
  risk: high
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_error_paths.py
  last_verified: 2025-11-14
- id: AUTH-ML-231
  title: Verify invalid token returns 429 when any lockout key exists
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_error_paths.py
  last_verified: 2025-11-14
- id: AUTH-ML-232
  title: Verify success resets failed attempts and logs magic_link_login_success
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/security/test_account_lockout.py
  last_verified: 2025-11-14
- id: AUTH-ML-240
  title: Start (unit) new user executes creation and sends verification
  level: unit
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start_new_user_handler.py
  last_verified: 2025-11-14
- id: AUTH-ML-241
  title: Start (unit) new user email failure returns 500
  level: unit
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start_new_user_handler.py
  last_verified: 2025-11-14
- id: AUTH-ML-242
  title: Start (unit) existing user creates login token and emails link
  level: unit
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start_existing_user_handler.py
  last_verified: 2025-11-14
- id: AUTH-ML-243
  title: Start (unit) existing user email failure returns 500
  level: unit
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start_existing_user_handler.py
  last_verified: 2025-11-14
- id: AUTH-ML-240
  title: Start new user creates user record and sends verification email
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start_new_user_lines.py
  last_verified: 2025-11-14
- id: AUTH-ML-241
  title: Start existing user sends login email
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_start_existing_user_lines.py
  last_verified: 2025-11-14
- id: AUTH-ML-242
  title: Verify invalid token lockout check and Redis error fallback
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_missing_lines.py
  last_verified: 2025-11-14
- id: AUTH-ML-243
  title: Verify precheck lockout returns 429 and records login_attempt_locked event
  level: integration
  markers:
  - integration
  - security
  risk: medium
  status: implemented
  tests:
  - backend/tests/auth/magic_link/test_magic_link_verify_precheck_lines.py
  last_verified: 2025-11-14
